# apply with `bosh interpolate ci/deploy-cf-perftest.yml -o ci/backfill-patch.yml > ci/generated-backfill-pipeline.yml`
- type: replace
  path: /resources/name=cf-performance-tests-pipeline/source/branch?
  value: ((cf_perf_tests_pipeline_source_branch))

- type: replace
  path: /resources/name=cf-deployment/source/tag_filter
  value: ((cf_deployment_tag_filter))

- type: replace
  path: /resources/name=cf-deployment-concourse-tasks/source/tag_filter
  value: ((cf_deployment_concourse_tasks_tag_filter))

- type: replace
  path: /resources/name=cf-acceptance-tests/source/tag_filter
  value: ((cf_acceptance_tests_tag_filter))

- type: replace
  path: /resources/-
  value:
    name: cf-performance-tests-pipeline-target
    type: git
    icon: github
    source:
      uri: https://github.com/sap-contributions/cf-performance-tests-pipeline.git
      username: ((temporary-github-token))
      password: x-oauth-basic
      branch: ((next_test_name))

- type: remove
  path: /jobs/name=detect-new-versions/plan/set_pipeline=self?

- type: replace
  path: /jobs/-
  value:
    name: set-next-pipeline-((next_test_name))
    serial: true
    plan:
      - in_parallel:
          - get: cf-performance-tests-pipeline
            trigger: true
            passed: [teardown]
          - get: cf-deployment
            trigger: true
            passed: [teardown]
          - get: concourse-tasks
      - try:
          do:
            - task: toggle
              file: concourse-tasks/toggle/task.yml
              params: { TOGGLE: ((more_tests)) }
            - put: cf-performance-tests-pipeline-target
              params:
                repository: cf-performance-tests-pipeline
                force: true
            - set_pipeline: cf-perf-test-((next_test_name))
              file: cf-performance-tests-pipeline/ci/generated-backfill-pipeline.yml
              var_files:
                - cf-performance-tests-pipeline/variables/common.yml
                - cf-performance-tests-pipeline/variables/cf-d-backfill/((next_test_name)).yml
